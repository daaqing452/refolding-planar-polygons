# 使用说明

### 部署与启动
进入工程的根目录，在命令行输入
```
npm install
npm install nodemon
nodemon index.js
```
然后打开浏览器，输入 URL `localhost:3000` 即可。
> 建议使用 Chrome 浏览器。

### 多边形编辑
界面中有左右两个可编辑区域，左区域用于编辑起始多边形，右区域用于编辑目标多边形。两个区域的编辑操作是完全相同的，下面以左区域为例进行说明：
- 添加一个新点与一条新的边：在区域内进行 **左键单击** 操作，会在鼠标点击的位置添加一个新点，同时试图在已有的最后一个点与新点之间连一条边。如果这条边与已有的任意一条边相交，则操作失效并在信息栏中给出提示，此时新点与新边都不会被添加。
- 闭合多边形：单击区域上方的 **Enclose** 按钮，会试图将区域内第一个和最后一个添加的点之间连一条边。如果这条边与已有的任意一条边相交，则操作失效，边不会被添加。
- 移动某个点：**左键拖动** 某个已有的点即可。
- 撤销最新的点：单击区域上方的 **Cancel** 按钮。此时分两种情况
    + 如果多边形已经闭合，则撤销闭合边
    + 如果多变形未闭合，则撤销最新加入的点及其对应的边

### 添加骨架

骨架可以看做是一个难以伸缩的刚体，进行多边形的变形的时候，变形会受到骨架长度的限制。

单击一个已经存在的点，可以选中这个点，同时这个点也会变成红色。再次点击这个点，该点会被取消选中，同时颜色变为黑色。

恰好选中两个点p和q，就可以点击"Skeleton"按钮添加一个连接p和q的骨架。骨架可以和多边形的边重合，也可以互相交叉。同时可以点"Cancel"按钮取消最新添加的骨架。

为了算法的设计和考虑，目前只支持在起始的图形上添加骨架。

### 运行和显示
运行的前提条件是：
- 左区域的多边形已闭合
- 右区域的多边形已闭合
- 左区域与右区域的点数完全相同

在满足上述条件的基础上，可以点击 **Run** 按钮来运行算法。算法有4个参数可以指定：
- Iteration：算法最大迭代次数。
- Threshold：阈值
- Alpha：
- Gamma：

算法运行过程中，会在左区域和右区域实时更新多边形的形状和位置。算法运行过程中有3个指标：
- s_energy：左区域多边形当前的能量值。
- t_energy：右区域多边形当前的能量值。
- distance：两个多边形的距离。

算法运行结束后可以有两种后续操作：
- 可以点击 **Display** 按钮来展示从起始多边形变化到目标多边形的全过程，该过程在下方区域中展示。
- 可以点击 **Reset** 按钮将左区域和右区域的多边形重置为初始状态（即算法运行之前的状态），然后可以再次点击 **Run** 按钮来再次运行算法。

### 保存和导入

编辑完一对多边形后（包括骨架），可以点击"Save"按钮保存当前的图形状态到一个json文件。文件会在服务器上保存一份，也可以下载到本地。

也可以通过"Load"按钮旁的下拉选择框，选择一个服务器上保存的图形状态json文件，点击"Load"按钮后导入到当前的多边形编辑界面中。